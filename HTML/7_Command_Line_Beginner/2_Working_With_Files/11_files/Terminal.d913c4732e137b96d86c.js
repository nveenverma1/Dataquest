(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{1447:function(e,t,n){"use strict";n.r(t);var r=n(14),i=n.n(r),o=n(0),s=n.n(o),a=n(1),l=n.n(a),c=n(15),u=n(5),_=n(2),p=n.n(_),m=(n(841),n(639)),d=n.n(m),h=n(74),f=n(356),v=n(302),b=(n(839),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),g={"./Scrollbar.scss":{vertical:"Scrollbar__vertical",background:"Scrollbar__background",handle_vertical:"Scrollbar__handle_vertical"}};function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function z(e){return e.charAt(0).toUpperCase()+e.substr(1)}var k={orientation:{horizontal:{dimension:"width",direction:"left",coordinate:"x"},vertical:{dimension:"height",direction:"top",coordinate:"y"}}},x=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r=w(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={slider_size:0},r.get_sizes=function(){var e=r.props,t=e.max,n=e.min,i=r.state.slider_size,o=t-n,s=30;if(0===i)return{limit:0,grab:0,handle_size:s};return{limit:i-(s=0===o?i:Math.max(i/o,30)),grab:s/2,handle_size:s}},r.handleSliderMouseDown=function(e){var t=r.props.onChange;if(t){var n=r.position(e);t&&t(n)}},r.handleKnobMouseDown=function(){document.addEventListener("mousemove",r.handleDrag),document.addEventListener("mouseup",r.handleDragEnd)},r.handleDrag=function(e){var t=r.props.onChange;if(t){var n=r.position(e);t&&t(n)}},r.handleDragEnd=function(){document.removeEventListener("mousemove",r.handleDrag),document.removeEventListener("mouseup",r.handleDragEnd)},r.handleNoop=function(e){e.stopPropagation(),e.preventDefault()},r.getPositionFromValue=function(e){var t=r.get_sizes().limit,n=r.props,i=n.min,o=n.max;if(i===o)return 0;var s=(e-i)/(o-i);return Math.round(s*t)},r.getValueFromPosition=function(e){var t=r.get_sizes().limit,n=r.props,i=n.orientation,o=n.min,s=n.max,a=n.step,l=function(e,t,n){return e<t?t:e>n?n:e}(e,0,t)/(t||1);return"horizontal"===i?a*Math.round(l*(s-o)/a)+o:s-a*Math.round(l*(s-o)/a)},r.position=function(e){if(null==r._slider)return 0;var t=r.get_sizes().grab,n=r.props.orientation,i=r._slider,o=k.orientation[n].coordinate,s=k.orientation[n].direction,a=e["client"+z(o)]-i.getBoundingClientRect()[s]-t;return r.getValueFromPosition(a)},r.coordinates=function(e){var t=r.get_sizes(),n=t.limit,i=t.grab,o=r.props.orientation,s=r.getValueFromPosition(e),a=r.getPositionFromValue(s);return{fill:"horizontal"===o?a+i:n-a+i,handle:a}},r.set_slider=function(e){r._slider=e,null!=e&&r.resized()},r.resized=function(){if(null!=r._slider){var e=r.props.orientation,t=z(k.orientation[e].dimension);r.setState({slider_size:r._slider["offset"+t]})}},w(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.a.PureComponent),b(t,[{key:"render",value:function(){var e,t=this.get_sizes().handle_size,n=this.props,r=n.value,o=n.orientation,a=k.orientation[o].dimension,l=k.orientation[o].direction,c=this.getPositionFromValue(r),u=t-4-4,_=(y(e={},l,this.coordinates(c).handle+4+"px"),y(e,a,u+"px"),e);return s.a.createElement("div",{ref:this.set_slider,onMouseDown:this.handleSliderMouseDown,onClick:this.handleNoop,className:i()(o,g)},s.a.createElement(f.a,{onResize:this.resized}),s.a.createElement("div",{className:"Scrollbar__background"}),s.a.createElement("button",{onMouseDown:this.handleKnobMouseDown,onClick:this.handleNoop,style:_,className:i()("handle_"+o,g)}))}}]),t}();x.propTypes={min:l.a.number,max:l.a.number,step:l.a.number,value:l.a.number,orientation:l.a.string,onChange:l.a.func,className:l.a.string},x.defaultProps={min:0,max:100,step:1,value:0,orientation:"vertical"},x.displayName="Scrollbar";var T=x,R=n(594),q=n(25),E=n(24);n.d(t,"selectors",function(){return M}),n.d(t,"actions",function(){return N}),n.d(t,"Terminal",function(){return C});var S=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},O={"./Terminal.scss":{root:"Terminal__root",term:"Terminal__term","terminal-text":"Terminal__terminal-text",scroll:"Terminal__scroll",not_this_step:"Terminal__not_this_step",term_hide:"Terminal__term_hide",term_show:"Terminal__term_show","terminal-cursor":"Terminal__terminal-cursor"}};function P(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var M=j({},R.b,{current_step_index:E.c.current_step_index,current_mission_id:function(e){return q.d.mission_info(e).id}}),N=R.a,D=Object(u.createStructuredSelector)(M),C=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r=P(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={slider_props:{value:0,min:0},reinitilizing:!1},r.cleanup_terminal=function(){r._terminal&&(r._terminal.destroy(),r._terminal=null)},r.is_this_step=function(){return r.props.for_project||r.props.terminal_step_index===r.props.current_step_index},r.create_terminal=function(e){if(r._terminal=new e.Term({cols:e.size.cols,rows:e.size.rows,useStyle:!1,screenKeys:!0,useMouse:!1}),r._terminal.on("data",e.send_data),r.update_cli_size(e),r.props.for_project){window.setTimeout(function(){return e.send_data("clear\n")},500)}},r.get_terminal_lines=function(){var e=r._terminal.lines,t=p.a.map(e,function(e){return p.a.trim(p.a.map(e,function(e){return e[1]}).join(""))});return p.a.filter(t,function(e){return e.length})},r.get_info_for_check=function(){var e=r.get_terminal_lines(),t=e.slice(0,-1),n=p.a.findLastIndex(t,function(e){return p.a.includes(e,"$")});if(-1===n)return"";var i=e.slice(n);return i=i.join("\r\n")},r.check_for_try_answer=function(e){if(null!=r._terminal&&!r.props.paused&&!r.props.answer_check.success&&p.a.endsWith(p.a.trim(e),"$")){var t=r.get_info_for_check();""!==t&&r.props.check_answer(t)}},r.onResize=function(){return r.update_cli_size()},r.update_cli_size=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.props;if(r._terminal&&r._sizer){var t=r.get_sizer_size(),n=r.get_box_size(),i=Math.floor(n.height/t.height),o=Math.floor(n.width/t.width);o=Math.min(o,80),o=Math.max(o,1),i=Math.max(i,1),(i=Math.min(i,30))===e.rows&&o===e.cols||e.resize({cols:o,rows:i})}},r.save_sizer_ref=function(e){r._sizer=e},r.save_box_ref=function(e){r._box=e},r.scroll_terminal=function(e){r._terminal.scrollDisp(-e-r._terminal.ydisp),r.setState({slider_props:{min:r.state.slider_props.min,value:e}})},r.possible_update_slider=function(){if(null!=r._terminal){var e=r._terminal,t=e.ydisp,n=e.ybase,i=r.state.slider_props,o=i.min;-t===i.value&&-n===o||r.setState({slider_props:{min:-n,value:-t}})}},r.term_ref=function(e){null!=r._terminal&&null!=e&&(r._terminal.open(e),r.update_cli_size())},P(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.a.PureComponent),S(t,[{key:"componentDidMount",value:function(){this.props.listen_for_terminal(),this.possibly_setup_socket(this.props),this.props.connected&&this.create_terminal(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.possibly_update_term(e),e.size!==this.props.size&&this.resize_term(e.size),e.current_step_index-1===e.terminal_step_index&&e.move_forward(),e.connected&&!this.props.connected&&this.create_terminal(e),!e.connected&&this.props.connected?e.connection_info!==this.props.connection_info?(this.props.disconnect_socket(),this.possibly_setup_socket(e)):this.reset_prompt():this.possibly_setup_socket(e)}},{key:"componentWillUnmount",value:function(){console.log("Terminal Unmounted"),this.cleanup_terminal()}},{key:"possibly_update_term",value:function(e){if(e.latest_data!==this.props.latest_data&&this._terminal){var t=e.latest_data.data;if(p.a.isEmpty(t))return;this._terminal.write(t),this.check_for_try_answer(t),this.possible_update_slider(t)}}},{key:"reset_prompt",value:function(){var e=this,t=this.props.failed_to_connect?"Something with the network went wrong, please try again":"You can only have one command line terminal connected at a time. If this is your current mission, please click reconnect to connect the terminal.";return this.props.dq_alert({title:"Network Issues",text:t,type:"warning",confirmButtonText:"Reconnect"}).then(function(){e.setState({reinitilizing:!0}),e.props.reset_terminal(e.props.current_step_index)}).catch(p.a.noop)}},{key:"possibly_setup_socket",value:function(e){null!=e.connection_info&&(e.connected&&e.connection_info.mission_id===e.current_mission_id||e.connected||(e.connection_info.mission_id===e.current_mission_id?e.setup_socket():this.reset_prompt()))}},{key:"get_sizer_size",value:function(){return{width:(this._sizer.clientWidth||"Terminal".length)/"Terminal".length,height:(this._sizer.clientHeight||1)/1}}},{key:"get_box_size",value:function(){return{width:this._box.clientWidth||0,height:this._box.clientHeight||0}}},{key:"resize_term",value:function(e){if(null!=this._terminal){var t=e.cols,n=e.rows;this._terminal.resize(t,n)}}},{key:"renderSlider",value:function(){return this._terminal&&this.is_this_step()?s.a.createElement("div",{className:"Terminal__scroll"},s.a.createElement(T,j({orientation:"vertical"},this.state.slider_props,{max:0,step:1,onChange:this.scroll_terminal}))):null}},{key:"renderMessages",value:function(){if(!this.is_this_step())return s.a.createElement("div",{className:"Terminal__not_this_step"},"To reset your terminal state for this screen, click the restore button below. Otherwise, click next to move to your active terminal session.");if(!this.props.connected){var e=this.state.reinitilizing?"Network issues reconnecting":"Initializing the command line terminal";return s.a.createElement(h.a,{message:e})}return null}},{key:"renderTerm",value:function(){var e=this.is_this_step()&&this._terminal?"term_show":"term_hide";return this.props.connected?s.a.createElement("div",{ref:this.term_ref,className:i()(e,O)}):null}},{key:"render",value:function(){return s.a.createElement("div",{className:"Terminal__root"},s.a.createElement("div",{ref:this.save_box_ref,className:"code "+this.props.className+" Terminal__term"},s.a.createElement(this.props.ResizeSensor,{onResize:this.onResize}),s.a.createElement("div",{ref:this.save_sizer_ref,className:"Terminal__terminal-text"},"Terminal"),this.renderMessages(),this.renderTerm(),this.renderSlider()))}}]),t}();C.propTypes={for_project:l.a.bool,className:l.a.string,current_step_index:l.a.number.isRequired,current_mission_id:l.a.string.isRequired,terminal_step_index:l.a.number.isRequired,latest_data:l.a.object.isRequired,size:l.a.shape({cols:l.a.number.isRequired,rows:l.a.number.isRequired}).isRequired,connected:l.a.bool.isRequired,failed_to_connect:l.a.bool.isRequired,paused:l.a.bool.isRequired,connection_info:l.a.shape({mission_id:l.a.string.isRequired}),answer_check:l.a.shape({success:l.a.bool.isRequired}).isRequired,listen_for_terminal:l.a.func.isRequired,resize:l.a.func.isRequired,check_answer:l.a.func.isRequired,send_data:l.a.func.isRequired,move_forward:l.a.func.isRequired,reset_terminal:l.a.func.isRequired,setup_socket:l.a.func.isRequired,disconnect_socket:l.a.func.isRequired,Term:l.a.func.isRequired,ResizeSensor:l.a.any.isRequired,dq_alert:l.a.func.isRequired},C.defaultProps={Term:d.a,ResizeSensor:f.a,dq_alert:v.a,className:""},C.displayName="Terminal";t.default=Object(c.b)(D,N)(C)},839:function(e,t,n){e.exports={vertical:"Scrollbar__vertical",background:"Scrollbar__background",handle_vertical:"Scrollbar__handle_vertical"}},841:function(e,t,n){e.exports={not_this_step:"Terminal__not_this_step",root:"Terminal__root",term:"Terminal__term","terminal-text":"Terminal__terminal-text",scroll:"Terminal__scroll",term_hide:"Terminal__term_hide",term_show:"Terminal__term_show"}}}]);
//# sourceMappingURL=Terminal.d913c4732e137b96d86c.js.map