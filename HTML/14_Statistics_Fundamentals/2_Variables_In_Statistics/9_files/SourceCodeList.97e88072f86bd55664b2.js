(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{1476:function(e,r,o){"use strict";o.r(r);var t={};o.r(t),o.d(t,"get_courses",function(){return x}),o.d(t,"get_source_code",function(){return N});var n=o(0),s=o.n(n),c=o(1),u=o.n(c),i=o(15),a=o(5),d=o(488),l=o.n(d),_=o(769),p=o.n(_),f=o(2),g=o.n(f),h=(o(712),o(425)),m=o(37),v=o(74),b=o(8),y=o.n(b),w=o(6),q={courses:[],courses_loaded:!1,source_code:{}},O=(Object.assign||function(e){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e})({},Object(w.make_simple_selectors)(q,"source_code_info")),j={reset:function(){return y()(q)}},R={set_courses:function(e,r){var o=r.payload;return e.merge({courses:g.a.map(o,function(e){var r=e.sequence,o=e.name;return{id:g.a.toString(r),title:o}}),courses_loaded:!0})},set_source_code:function(e,r){var o=r.payload;return e.set("source_code",o)},clear_source_code:function(e){return e.set("source_code",q.source_code)}},E=Object(w.make_reducer_n_actions)({public_handlers:j,private_handlers:R,action_types_prefix:"source_code_info/",initial_state:q,Immutable:y.a}),S=E.reducer,C=E.private_actions,k=E.actions,L=(E.ACTION_TYPES,S),P=o(4),x=function(e){var r=e.user_id;return function(e,o){var t="/api/v1/accounts/public/users/"+r+"/courses/";return Object(P.b)(t).then(function(r){e(C.set_courses(r))}).catch(console.error)}},N=function(e){var r=e.user_id,o=e.course_id;return function(e,t){e(C.clear_source_code());var n="query {\n    source_code(user_id:"+r+", course_sequence:"+o+") {\n      slug\n      missions {\n        slug\n        language\n        filename_extension\n        source_code\n      }\n    }\n  }";return Object(P.c)(n).then(function(r){return e(C.set_source_code({course_id:o,source_code:r.data.source_code}))}).catch(console.error)}},T=o(10),A=Object.assign({},k,t);Object(T.a)({source_code_info:L});o.d(r,"selectors",function(){return I}),o.d(r,"actions",function(){return J}),o.d(r,"SourceCodeList",function(){return z});var Z=function(){function e(e,r){for(var o=0;o<r.length;o++){var t=r[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,o,t){return o&&e(r.prototype,o),t&&e(r,t),r}}();function D(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}var I=O,J=A,W=Object(a.createStructuredSelector)(I),z=function(e){function r(){var e,o,t;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r);for(var n=arguments.length,c=Array(n),u=0;u<n;u++)c[u]=arguments[u];return o=t=D(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(c))),t.state={requesting_download:!1},t.request_download=function(e){var r=e.course_id,o=e.title;t.setState({requesting_download:o}),t.props.get_source_code({course_id:r,user_id:t.props.user_id})},t.render_course=function(e){return s.a.createElement(h.a,{key:e.id,course_id:e.id,title:e.title,onClick:t.request_download},s.a.createElement("div",{className:"meta-light small SourceCodeList__download"},s.a.createElement(m.a,{name:"download"})," ",s.a.createElement("span",null,e.title)))},D(t,o)}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}(r,s.a.PureComponent),Z(r,[{key:"componentWillMount",value:function(){this.props.user_id&&this.props.get_courses({user_id:this.props.user_id})}},{key:"componentWillReceiveProps",value:function(e){e.user_id&&!this.props.user_id&&this.props.get_courses({user_id:e.user_id});var r=e.source_code.course_id;null!=r&&r!==this.props.source_code.course_id&&this.download_source_code(e.source_code.source_code)}},{key:"download_source_code",value:function(e){var r=this,o=new this.props.Zip;g.a.forEach(e.missions,function(e){var r=e.slug+"."+e.filename_extension;o.file(r,e.source_code)}),o.generateAsync({type:"blob"}).then(function(o){l.a.saveAs(o,e.slug+".zip"),r.setState({requesting_download:!1})})}},{key:"render",value:function(){return this.props.courses_loaded?!1!==this.state.requesting_download?s.a.createElement("div",{className:"SourceCodeList__root"},s.a.createElement(v.a,{message:"Downloading "+this.state.requesting_download})):s.a.createElement("div",{className:"SourceCodeList__root"},s.a.createElement("p",null,"Download your course code"),g.a.map(this.props.courses,this.render_course)):s.a.createElement("div",{className:"SourceCodeList__root"},s.a.createElement(v.a,{message:"Loading Courses"}))}}]),r}();z.propTypes={user_id:u.a.string.isRequired,courses:u.a.arrayOf(u.a.shape({id:u.a.string.isRequired,title:u.a.string.isRequired})).isRequired,courses_loaded:u.a.bool.isRequired,source_code:u.a.shape({course_id:u.a.string,source_code:u.a.shape({slug:u.a.string.isRequired,missions:u.a.arrayOf(u.a.shape({slug:u.a.string.isRequired,filename_extension:u.a.string.isRequired,source_code:u.a.string.isRequired})).isRequired})}).isRequired,get_courses:u.a.func.isRequired,get_source_code:u.a.func.isRequired,Zip:u.a.func.isRequired},z.defaultProps={Zip:p.a},z.displayName="SourceCodeList";r.default=Object(i.b)(W,J)(z)},712:function(e,r,o){e.exports={root:"SourceCodeList__root",download:"SourceCodeList__download"}},760:function(e,r){},762:function(e,r){}}]);
//# sourceMappingURL=SourceCodeList.97e88072f86bd55664b2.js.map